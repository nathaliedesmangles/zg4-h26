+++
pre = 'Semaine 9 : '
title = 'Recherches et filtres'
weight = 90
+++


## Objectif de la semaine

* Comprendre comment manipuler les flux de donn√©es pour combiner des commandes simples et r√©aliser des t√¢ches complexes.

**Fichier pour les exercices (en classe)**
Utiliser le fichier **exo-semaine9.docx** pour y mettre vos r√©ponses et captures d'√©cran.  
{{% button href="/docs/Exercices/exo-semaine9.docx" icon="download" %}}T√©l√©charger le fichier docx{{% /button %}}

---

# Th√©orie


## Les filtres indispensables

Le Pipe sert √† envoyer des donn√©es vers des filtres. Voici les plus utilis√©s :

***FIND, WC -w -m -c***

* **`sort`** : Trie les lignes par ordre alphab√©tique ou num√©rique.
* **`uniq`** : Supprime les doublons **adjacents** (il faut souvent trier avant !).
* **`grep "mot"`** : Ne garde que les lignes contenant "mot".
* **`wc -l`** : Compte le nombre de lignes (*Word Count -lines*).
* **`head` / `tail**` : Affiche les premi√®res ou derni√®res lignes.


### üü¢ Exercice #1 (En classe)

* Le dossier `/etc` contient des centaines de fichiers de configuration.
* Afficher uniquement les fichiers contenant "conf" dans leur nom, et les trier √† l'envers.

<!--
**Reponse**
```bash
ls /etc | grep "conf" | sort -r
```
-->

*Discussion : Que se passe si on enl√®ve le `grep`?*

### üü¢ Exercice #2 (En classe)

* On veut savoir combien d'objets se trouvent dans le dossier `/bin` (l√† o√π sont stock√©es les commandes comme ls, cp, etc.).
* Compter les fichiers.

<!--
Reponse
```bash
ls /bin | wc -l
```
-->

**Discussion** : Pourquoi ne pas simplement faire `ls /bin` et compter √† la main ? 
<!--(R√©ponse : Trop long, risque d'erreur, automatisation impossible).-->


---

# Laboratoire

Utiliser le fichier **labo9.docx** pour y mettre vos r√©ponses et captures d'√©cran.  
{{% button href="/docs/Labos/labo9.docx" icon="download" %}}T√©l√©charger le fichier docx{{% /button %}}

Vous √™tes administrateur syst√®me. On vous donne une liste brute d'utilisateurs suspects et de tentatives de connexion. Votre but est de nettoyer ces donn√©es pour en extraire des statistiques utiles.

### √âtape 1 : Cr√©ation des donn√©es (Setup)

Cr√©ez un fichier sale avec des doublons et des donn√©es d√©sordonn√©es. Copiez/collez ces commandes :

```bash
echo "Martin" > utilisateurs.txt
echo "Julie" >> utilisateurs.txt
echo "Martin" >> utilisateurs.txt
echo "Alain" >> utilisateurs.txt
echo "Julie" >> utilisateurs.txt
echo "Zoe" >> utilisateurs.txt
echo "Martin" >> utilisateurs.txt
```

### √âtape 2 : Le nettoyage (Sort & Uniq)

Si vous faites `uniq utilisateurs.txt`, cela ne fonctionnera pas parfaitement car `uniq` ne voit que les doublons qui se touchent.

1. Affichez le contenu brut 
2. Triez le fichier et affichez le r√©sultat √† l'√©cran
3. Utilisez le pipe pour trier PUIS supprimer les doublons

<!--
Reponse
```bash
cat utilisateurs.txt | sort | uniq
```
-->

4. **D√©fi :** Redirigez cette liste propre vers un nouveau fichier nomm√© `utilisateurs_propres.txt`.

### √âtape 3 : L'enqu√™te (Grep & Wc)

Nous allons simuler un fichier de journal syst√®me (log).

```bash
# Cr√©ation du fichier log (copiez tout le bloc)
echo "[INFO] Connexion r√©ussie : Martin" > system.log
echo "[ERREUR] √âchec de connexion : Hacker" >> system.log
echo "[INFO] Connexion r√©ussie : Julie" >> system.log
echo "[ERREUR] √âchec de connexion : Hacker" >> system.log
echo "[INFO] Connexion r√©ussie : Alain" >> system.log
echo "[ERREUR] √âchec de connexion : Hacker" >> system.log
```

1. Utilisez `grep` pour n'afficher que les lignes contenant "ERREUR".
2. Utilisez un pipe et `wc -l` pour compter combien de fois le mot "ERREUR" appara√Æt.

<!--**Commande attendue :**

```bash
cat system.log | grep "ERREUR" | wc -l
```
-->


### √âtape 4 : Le grand final (History)

L'historique de votre terminal garde tout ce que vous avez tap√©.

1. Utilisez la commande `history`.
2. Utilisez un pipe pour trouver combien de fois vous avez utilis√© la commande `echo` aujourd'hui.

<!--**Solution :** `history | grep "echo" | wc -l` -->

<!--

### Note p√©dagogique pour l'enseignant

* **Erreur fr√©quente :** Les √©tudiants oublient souvent que `uniq` n√©cessite un `sort` au pr√©alable. Insistez sur l'analogie : "On ne peut pas empiler les chemises identiques si elles sont √©parpill√©es dans toute la pi√®ce; il faut d'abord les trier par couleur/type."
* **Le danger du `>` :** Faites leur remarquer que s'ils font `cat fichier | sort > fichier`, ils risquent d'effacer le fichier avant m√™me de le lire (selon le shell). Il vaut mieux rediriger vers un *nouveau* nom (`fichier_tri√©.txt`).
-->



==============================================


# LABORATOIRE

**Objectif :** Manipuler des logs et extraire de l'information pr√©cise.

## √âtape 1 : Dompter les fichiers (Redirections)

*Pas d'√©diteur de texte autoris√© ici !*

1. Utilisez `echo` et `>` pour cr√©er un fichier `mes_films.txt` avec le titre "Star Wars".
2. Utilisez `>>` pour ajouter "Le Seigneur des Anneaux" et "Matrix" (3 commandes distinctes).
3. V√©rifiez avec `cat`.
4. Lancez une commande qui plante (ex: `ls /root` en tant qu'√©tudiant).
5. Relancez-la en cachant l'erreur : `ls /root 2> /dev/null`. Le terminal doit rester muet.

## √âtape 2 : L'aiguille dans la botte de foin (`grep`)

*Le fichier `/etc/passwd` est parfait pour s'exercer.*

1. Affichez le fichier `/etc/passwd`. C'est illisible ?
2. Utilisez un Pipe et `head` pour voir seulement les 5 premiers utilisateurs.
3. Utilisez `grep` pour trouver la ligne correspondant √† votre utilisateur (`etudiant`).
4. Utilisez `grep` pour trouver tous les utilisateurs qui n'ont **pas** de shell de connexion (cherchez `/usr/sbin/nologin`).
5. **D√©fi :** Comptez combien il y en a en ajoutant `| wc -l` √† la fin.

## √âtape 3 : Le d√©tective (`find`)

*La commande `find` est diff√©rente, elle cherche des FICHIERS, pas du texte.*

1. Trouvez tous les fichiers qui se terminent par `.conf` dans `/etc` :
`find /etc -name "*.conf"`
*(Vous aurez plein d'erreurs "Permission denied". C'est normal !)*
2. Refaites la commande en envoyant les erreurs dans le n√©ant pour avoir une liste propre :
`find /etc -name "*.conf" 2> /dev/null`
3. Trouvez tous les fichiers modifi√©s dans les derni√®res 24 heures dans votre dossier home :
`find ~ -mtime -1`

## √âtape 4 : Le "CSI Linux" (Probl√®me complexe) (15 min)

*Sc√©nario :* Vous devez lister les 3 derniers utilisateurs cr√©√©s sur le syst√®me, tri√©s par ordre alphab√©tique.
*Indice : `/etc/passwd` contient les infos, `tail` prend la fin, `sort` trie, `cut` d√©coupe.*

<!--
*Solution √† faire trouver par les √©tudiants :*
`tail -n 3 /etc/passwd | cut -d: -f1 | sort`
-->

---

### üí° Astuces de la semaine


> 
> 
> **Les 3 commandes en or :**
> * `grep "mot"` : Garde seulement les lignes avec "mot".
> * `wc -l` : Compte les lignes.
> * `sort` : Met en ordre.
> 
>
